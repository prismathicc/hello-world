<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>table v1.0</title>
	<style type="text/css">
		@import url('https://fonts.googleapis.com/css?family=Montserrat:500,700,900&display=swap');
		*{
			box-sizing: border-box;
		}
		body{
			width: 100vw;
			height: 100vh;
			margin: 0;
			padding: 0;
			user-select: none;
			font-family: 'Montserrat';
			font-size: 3vh;
			display: flex;
			justify-content: center;
			align-items: center;
			overflow: hidden;
		}
		#settings-display{
			width: 0%;
			opacity: 0;
			transition: all .5s ease;
			border-right: 2px solid rgba(0,0,0,.2);
		}
		#settings-main-block{
			width: 100%;
			height: 75vh;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
		}
		#settings-main-block-label{
			cursor: pointer;
			color: rgba(0,0,0,.5);
			height: 20%;
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			transition: all .25s ease;
		}
		#settings-main-block-label:after{
			content: '>';
			margin-left: 5px;
			opacity: 0;
			transition: all .25s ease;
		}
		#settings-main-block-label:before{
			content: '<';
			margin-right: 5px;
			opacity: 0;
			transition: all .25s ease;
		}
		#settings-main-block-label:hover::after{
			opacity: 1;
			margin-left: 15px;
		}
		#settings-main-block-label:hover::before{
			opacity: 1;
			margin-right: 15px;
		}
		#settings-table-block,#settings-item-block{
			height: 80%;
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
		}
		#table-block-input-area,#item-block-input-area{
			color: rgba(0,0,0,.65);
			font-size: 15px;
			height: 20%;
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		#tb-x,#tb-y{
			margin-right: 3%;
			margin-left: 3%;
			width: 30%;
			height: 50%;
		}
		#ib-place,#ib-text,#ib-color{
			width: 30%;
			height: 50%;
			margin-right: 3%;
			margin-left: 3%;
		}
		.input,#ib-place{
			transition: all .5s ease;
			outline: none;
			border-radius: 10px;
			font-family: 'Montserrat';
			text-align: center;
			padding-left: 3px;
			border: 0;
			border: 2px solid transparent;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		.input:focus{
			border: 2px solid rgba(0,0,0,.2);
		}
		.input:focus::placeholder{
			color: transparent;
		}
		.input[type=number]::-webkit-inner-spin-button,
		.input[type=number]::-webkit-outer-spin-button {
		    -webkit-appearance: none;
		    margin: 0;
		}
		.button{
			transition: all .25s ease;
			outline: none;
			border-radius: 10px;
			font-family: 'Montserrat';
			text-align: center;
			border: 0;
			border: 2px solid rgba(0,0,0,.2);
			background: transparent;
		}
		.button:hover{
			cursor: pointer;
			background: rgba(0,0,0,.2);
			border-color: transparent;
			color: white;
			transform: scale(1.3);
		}
		.button:active{
			transform: scale(1.15);
		}
		#tb-c,#ib-r{
			width: 50%;
			height: 50%;
		}
		#table-block-preview-area,#item-block-preview-area{
			color: rgba(0,0,0,.5);
			font-size: 15px;
			height: 60%;
			width: 100%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		#table-block-button-area,#item-block-button-area{
			width: 100%;
			height: 20%;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			font-size: 12px;
		}
		#table-block-button-area button, #item-block-button-area button{
			margin-bottom: 5px;
		}
		#table-block-button-area div, #item-block-button-area div{
			width: 65%;
			text-align: center;
			color: rgba(0,0,0,.5);
		}
		#main-display{
			display: flex;
			justify-content: center;
			align-items: center;
			height: 100%;
			flex-grow: 1;
		}
		#main{
			width: 75%;
			height: 75%;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		#table-wrap{
			width: 100%;
			height: 100%;
			display: flex;
			box-sizing: border-box;
		}
		.column{
			width: 1px;
			height: 100%;
			display: flex;
			flex-direction: column;
			box-sizing: border-box;
			margin-left: 2px;
		}
		.cell{
			width: 100%;
			height: 1px;
			box-sizing: border-box;
			display: flex;
			justify-content: center;
			align-items: center;
			border-radius: 3px;
			border: 2px solid rgba(0,0,0,.2);
			margin-top: 2px;
			padding: 3px;
		}
		.item{
			width: 100%;
			height: 100%;
			overflow-y: auto;
			overflow-x: auto;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 3px;
		}
		.mini-item{
			width: 75%;
			height: 75%;
			overflow-y: auto;
			overflow-x: auto;
			display: flex;
			align-items: center;
			justify-content: center;
			border-radius: 3px;
			color: black;
			font-size: 20px;
		}
		#add-item{
			position: absolute;
			bottom: 3%;
			left: 3%;
			font-size: 15px;
			display: flex;
			opacity: .5;
		}
		#add-table{
			position: absolute;
			bottom: 3%;
			right: 3%;
			font-size: 15px;
			display: flex;
			opacity: .5;
		}
		#info{
			position: absolute;
			bottom: 5%;
			right: 5%;
			font-size: 15px;
			display: flex;
			opacity: .5;
		}
		.uibutton{
			position: absolute;
			transition: all .5s ease;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
			width: calc(3vh + 2vw);
			height: calc(3vh + 2vw);
		}
		#settings-block{
			top: 7%;
			left: 5%;
		}
		#remove-block{
			top: 7%;
			right: 5%;
		}
		.uiicon{
			width: 100%;
			height: 100%;
			transition: all .5s ease;
		}
		.uilabel{
			opacity: 0;
			transition: all .5s ease;
			font-size: 15px;
			color: rgba(0,0,0,.5);
		}
		.uibutton:hover{
			transform: scale(1.25);
			cursor: pointer;
		}
		#settings-block:hover > #settings-label{
			display: block;
			opacity: 1;
		}
		#settings-block:hover > #settings-icon{
			transform: rotate(180deg);
		}
		#remove-block:hover > #remove-label{
			display: block;
			opacity: 1;
			color: red;
		}
		.mini-table{
			width: 75%;
			height: 75%;
			display: flex;
		}
		.mini-column{
			height: 100%;
			display: flex;
			flex-direction: column;
			box-sizing: border-box;
			margin-left: 1px;
		}
		.mini-cell{
			width: 100%;
			box-sizing: border-box;
			display: flex;
			justify-content: center;
			align-items: center;
			border-radius: 3px;
			margin-top: 1px;
			background: rgba(0,0,0,.1);
		}
	</style>
</head>
<body onmouseup="put()" onmousemove="move(window.innerWidth,window.innerHeight,event.clientX,event.clientY,event.target)">
	<div id="settings-display">
		<div id="settings-main-block">
			<div id="settings-main-block-label" onclick="switchLabel(this)">
				<div>
					Таблица
				</div>
			</div>
			<div id="settings-table-block">
				<div id="table-block-input-area">
					<input type="number" id="tb-x" placeholder="Ш" class="input" oninput="generateMiniTable([eval(this.value),eval(this.parentElement.children[1].value)])" max="56" maxlength="2">на
					<input type="number" id="tb-y" placeholder="В" class="input" oninput="generateMiniTable([eval(this.parentElement.children[0].value),eval(this.value)])" max="56" maxlength="2">
				</div>
				<div id="table-block-preview-area">
					
				</div>
				<div id="table-block-button-area">
					<button class="button" id="tb-c" onclick="generateTable()">Создать</button>
				</div>
			</div>
			<div id="settings-item-block" style="display: none">
				<div id="item-block-input-area">
					<div id="ib-place">0;0</div>
					<input type="text" id="ib-text" class="input" placeholder="Текст" oninput="changeMiniItem([this.parentElement.children[0].innerText,this.value,this.parentElement.children[2].value])">
					<input type="text" id="ib-color" class="input" placeholder="Цвет" oninput="changeMiniItem([this.parentElement.children[0].innerText,this.parentElement.children[1].value,this.value])">
				</div>
				<div id="item-block-preview-area">
					
				</div>
				<div id="item-block-button-area">
					<button class="button" id="ib-r" onclick="generateItem()">Заменить</button>
					<div>ЛКМ по клетке для выбора.</div>
				</div>
			</div>
		</div>
	</div>
	<div id="main-display">
		<div id="main">
			<div id="table-wrap">
			</div>
			<div class="uibutton" id="remove-block" onmouseup="removeItem(this)">
				<img class="uiicon" src="https://img.icons8.com/material-outlined/100/000000/delete-trash.png" id="remove-icon">
				<div class="uilabel" id="remove-label">Удалить</div>
			</div>
			<div class="uibutton" id="settings-block" onclick="switchSideDisplay()">
				<img class="uiicon" src="https://img.icons8.com/material-outlined/100/000000/settings.png" id="settings-icon">
				<div class="uilabel" id="settings-label">Параметры</div>
			</div>
			<div id="info">
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var pickedId = '';
	var firstParent;
	var opponent;
	var opponentFirstParent;
	var highlighted;
	var miniTableData = [3,3];
	var miniItemData = ['2;2','Элемент','lightblue'];
	function pick(e,w,h,mx,my){
		e.style.transform = 'scale(0.75)';
		e.style.opacity = .7;
		pickedId = e.id;
		firstParent = e.parentElement;
		e.style.position = 'absolute';
		e.style.width = e.parentElement.parentElement.style.width;
		e.style.height = e.parentElement.style.height;
		e.style.transition = '';
		e.style.top = my/h*100+'%';
		e.style.left = mx/w*100+'%';
		var highlight = e.parentElement;
		if(pickedId !== ''){
			if(e !== highlighted && highlighted !== undefined){
				highlighted.firstChild.style.display = 'none';
			}
			highlighted = e.parentElement;
			highlight.style.display = 'block';
			highlight.style.borderColor = e.style.backgroundColor;
		}
	}
	function move(w,h,mx,my,target){
		if(pickedId !== ''){
			var item = document.getElementById(pickedId);
			item.style.top = my/h*100+'%';
			item.style.left = mx/w*100+'%';
			if(target == document.body){
				put();
			}
		}
	}
	function preview(e){
		var item = document.getElementById(pickedId);
		var secondItem = e.children[0];
		var cells = document.getElementsByClassName('cell');
		var info = document.getElementById('info');
		if(pickedId !== ''){
			if(e !== highlighted && highlighted !== undefined){
				highlighted.style.borderColor = 'rgba(0,0,0,.2)';
			}
			highlighted = e;
			e.style.borderColor = item.style.backgroundColor;
		}
		info.innerHTML = 'Клетка '+e.id;
		if(e.classList.length == 1 && pickedId !== ''){
			var cells = document.getElementsByClassName('cell');
			e.classList.add(item.id);
			e.appendChild(item);
		}
		if(e.classList.length == 2 && pickedId !== '' && item.parentElement !== e){
			if(opponent == undefined){
				opponent = secondItem;
				opponentFirstParent = e;
			}
			e.classList.add(item.id);
			firstParent.classList.add(secondItem.id);
			e.classList.remove(secondItem.id);
			firstParent.classList.remove(item.id);
			firstParent.appendChild(secondItem);
			e.appendChild(item);
		}
		for(var i=0;i<cells.length;i++){
			if(pickedId !== '' && cells[i] !== e && cells[i].classList.contains(item.id)){
				cells[i].classList.remove(item.id);
			}
		}
		if(e !== opponentFirstParent && opponent !== undefined){
			opponent.parentElement.classList.remove(opponent.id);
			opponentFirstParent.classList.add(opponent.id);
			opponentFirstParent.appendChild(opponent);
			if(opponent !== secondItem){
				opponent = secondItem;
				opponentFirstParent = e;
			}
		}
	}
	function put(){
		if(pickedId !== ''){
			var item = document.getElementById(pickedId);
			item.style.transform = '';
			item.style.opacity = 1;
			item.style.position = '';
			item.style.width = '100%';
			item.style.height = '100%';
			item.style.transition = 'all .1s ease';
			pickedId = '';
			firstParent = undefined;
			highlighted.style.borderColor = 'rgba(0,0,0,.2)';
			highlighted = undefined;
			opponent = undefined;
			opponentFirstParent = undefined;
		}
	}
	function generateTable(data){
			var main = document.getElementById('main');
			document.getElementById('table-wrap').remove();
			var tableWrap = document.createElement('div');
			tableWrap.id = 'table-wrap';
			main.appendChild(tableWrap);
			var data = miniTableData;
			for(var i=0;i<data[0];i++){
				var newcolumn = document.createElement('div');
				newcolumn.classList.add('column');
				newcolumn.style.width = 100/data[0]+'%';
				tableWrap.appendChild(newcolumn);
			}
			for(var i=0;i<tableWrap.children.length;i++){
				for(var j=0;j<data[1];j++){
					var newCell = document.createElement('div');
					newCell.classList.add('cell');
					newCell.onmousemove = function(){preview(this)};
					newCell.onmousedown = function(){switchCreatePlace(this)};
					newCell.style.height = 100/data[1]+'%';
					newCell.id = (i+1)+';'+(j+1)
					tableWrap.children[i].appendChild(newCell);
				}
			}
	}
	function generateMiniTable(data){
		var container = document.getElementById('table-block-preview-area');
		if(eval(data[0]) > 40 || eval(data[1]) > 40){
			container.innerHTML = 'Превышен лимит размера!'
		} else {
			miniTableData = data;
			if(document.getElementsByClassName('mini-table')[0] !== undefined){
				document.getElementsByClassName('mini-table')[0].remove();
			}
			container.innerHTML = '';
			var tableWrap = document.createElement('div');
			tableWrap.classList.add('mini-table');
			container.appendChild(tableWrap);
			for(var i=0;i<data[0];i++){
					var newcolumn = document.createElement('div');
					newcolumn.classList.add('mini-column');
					newcolumn.style.width = 100/data[0]+'%';
					tableWrap.appendChild(newcolumn);
				}
			for(var i=0;i<tableWrap.children.length;i++){
				for(var j=0;j<data[1];j++){
					var newCell = document.createElement('div');
					var newCellHL = document.createElement('div');
					newCell.classList.add('mini-cell');
					newCell.onmousemove = function(){preview(this)};
					newCell.onmousedown = function(){turnToPlace(this)};
					newCell.style.height = 100/data[1]+'%';
					newCell.appendChild(newCellHL);
					tableWrap.children[i].appendChild(newCell);
				}
			}
		}
	}
	function generateItem(data,console){
		var tableWrap = document.getElementById('table-wrap');
		var items = document.getElementsByClassName('item');
		var newItem = document.createElement('div');
		if(console){
			var cell = document.getElementById(data[0]);
			newItem.classList.add('item');
			newItem.onmousedown = function(){pick(this,window.innerWidth,window.innerHeight,event.clientX,event.clientY,event.target)};
			newItem.innerHTML = data[1];
			newItem.style.backgroundColor = data[2];
			newItem.id = items.length;
			if(cell.children.length > 0){
				cell.children[0].remove();
			}
			cell.classList.add(newItem.id);
			cell.appendChild(newItem);
		} else {
			var cell = document.getElementById(miniItemData[0]);
			newItem.classList.add('item');
			newItem.onmousedown = function(){pick(this,window.innerWidth,window.innerHeight,event.clientX,event.clientY,event.target)};
			newItem.innerHTML = miniItemData[1];
			newItem.style.backgroundColor = miniItemData[2];
			newItem.id = items.length;
			cell.appendChild(newItem);
			if(cell.children.length > 0){
				cell.children[0].remove();
			}
			cell.classList.add(newItem.id);
			cell.appendChild(newItem);
		}
	}
	function generateMiniItem(data){
		var container = document.getElementById('item-block-preview-area');
		var newItem = document.createElement('div');
		newItem.classList.add('mini-item');
		newItem.innerHTML = data[1];
		newItem.style.backgroundColor = data[2];
		container.appendChild(newItem);
	}
	function changeMiniItem(data){
		var item = document.getElementById('item-block-preview-area').children[0];
		var coords = document.getElementById('item-block-input-area').children[0].innerText;
		item.innerHTML = data[1];
		item.style.backgroundColor = data[2];
		miniItemData = data;
	}
	function removeItem(){
		if(pickedId !== ''){
			document.getElementById(pickedId).parentElement.classList.remove(pickedId);
			document.getElementById(pickedId).remove();
			pickedId = '';
			highlighted.style.borderColor = 'rgba(0,0,0,.2)';
			highlighted = undefined;
		}
	}
	function switchSideDisplay(){
		var display = document.getElementById('settings-display');
		if(display.style.opacity == 0){
			display.style.opacity = 1;
			display.style.width = '30%';
		} else {
			display.style.opacity = 0;
			display.style.width = '0%';
		}
	}
	function switchLabel(e){
		var label = e.children[0];
		var tableBlock = document.getElementById('settings-table-block');
		var itemBlock = document.getElementById('settings-item-block');
		if(label.innerText == 'Таблица'){
			tableBlock.style.display = 'none';
			itemBlock.style.display = 'block';
			label.innerHTML = 'Элементы';
		} else {
			tableBlock.style.display = 'block';
			itemBlock.style.display = 'none';
			label.innerHTML = 'Таблица';
		}
	}
	function switchCreatePlace(e){
		var coords = document.getElementById('item-block-input-area').children[0];
		coords.innerHTML = e.id;
		miniItemData[0] = e.id;
	}
	generateTable();
	generateMiniTable([3,3]);
	generateItem(['2;2','by prismatic_','lightgreen'],true);
	generateMiniItem(['2;2','Элемент','lightblue']);
</script>
</html>
